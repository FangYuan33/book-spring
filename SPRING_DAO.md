## Spring-Dao

### 1. 事务
**事务是一组逻辑操作的组合**，它们执行的结果要么全部成功，要么全部失败

事务的4个特性：
1. **原子性**: **一个事务是不可再分的单**位，事务中的操作要么全部做，要么全部不做，原子性强调的是事务的整体
2. **一致性**: 事务执行后，所有的数据都应该保持一致状态，**强调数据的完整**
3. **隔离性**: 多个数据库操作并发执行时，一个请求的事务操作不能被其它操作干扰，多个并发事务执行之间要相互隔离。**隔离性强调的是并发的隔离**
4. **持久性**: 事务执行完成后，它对数据的影响是永久性的。**持久性强调的是操作的结果**

事务**并发操作**中会出现三种问题：
1. **脏读**：一个事务读到了另一个事务没有提交的数据
2. **不可重复读**：一个事务读到了另一个事务已提交修改的数据
   - 对同一行数据查询两次，结果不一致
3. **幻读**：一个事务读到了另一个事务已提交新增的数据
   - 对同一张表查询两次，出现新增的行，导致结果不一致

针对上述问题，引出了**事务的隔离级别**：
1. **read uncommitted**: 未提交读 —— 不解决任何问题
2. **read committed**: 提交读 —— **解决脏读**
3. **repeatable read**: 可重复读 —— **解决脏读、不可重复读**
4. **serializable**: 可串行化 —— **解决脏读、不可重复读、幻读**

### 2. 编程式事务
#### 2.1 DataSourceTransactionManager
**基于数据源的事务管理器**。它实现的根接口 `PlatformTransactionManager` 有定义 `commit` 和 `rollback` 方法

#### 2.2 TransactionTemplate
它提交和回滚事务的动作，就是拿的 `TransactionManager` 执行的 `commit` 和 `rollback` 方法

### 3. 声明式事务
#### 3.1 @Transactional

- **isolation**：事务隔离级别, **默认是 DEFAULT**，即依据数据库默认的事务隔离级别来定
- **timeout**：事务超时时间，当事务执行超过指定时间后，事务会自动中止并回滚，单位 秒 。默认值 -1 ，代表永不超时
- **readOnly**：设置是否为只读事务。默认值 false ，代表**读写型事务**
   - 当设置为 true 时，当前事务为只读事务，通常用于查询操作（此时不会有 setAutoCommit(false) 等操作，可以加快查询速度）
  
- **rollbackFor**：当方法触发指定异常时，事务回滚，需要传入异常类的全限定名
   - 默认值为空，代表捕捉所有 RuntimeException 和 Error 的子类
   - 一般情况下，在日常开发中，我们都会显式声明其为 Exception，**目的是一起捕捉非运行时异常**

- **noRollbackFor**：当方法触发指定异常时，事务不回滚继续执行，需要传入异常类的全限定名。默认值为空，代表不忽略异常
- **propagation**：事务传播行为